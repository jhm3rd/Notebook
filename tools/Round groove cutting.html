<html>
<head>
<title> Cutting Round Grooves on the Lathe</title>
<style type="text/css">
	body {
		margin-left: 40px;
		background-color: #F7F7F7;
		font-family: Tahoma, Geneva, sans-serif;
		line-height: 1.4;
		max-width: 900px;
	}
	h1 {
		font-variant: small-caps;
		text-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.4);
		text-align: center;
	}
	h2 {
		text-align: center;
	}
	h3.minor {
		font-variant: small-caps;
	}
	address {
		margin-left: 250px;
	}
	p.indent {
		margin-left: 20px;
	}
	p.centered {
		text-align: center;
	}
	p.note {
		text-align: center;
		font-variant: small-caps;
		width: 80%;
		margin-left: 50px;
	}
	div p {
		margin-left: 20px;
	}
	li.indent {
		margin-left: 20px;
	}
	dt.indent {
		margin-left: 60px;
		font-weight: bold;
	}
	dt {
		font-size: 14px;
	    list-style-position: inside;
    	text-indent: -1em;
    	padding-left: 1em;
    	font-variant: italic;
	}
	dl.centered {
		text-align: center;
	}
	canvas {
		float: left;
		margin: 3px 15px 30px 10px;
	}
	label {
		display: inline-block;
		width: 500px;
		font-weight: bold;
	}
	label.output {
		text-align: right;
	}
	form {
		margin-left: 60px;
	}
	input[type="text"] {
		width: 80px;
		font-size: 80%;
	}
	input[type="button"] {
		width: 300px;
	}
	footer {
		font-size: 9px;
		text-align: center;
	}
  	table {
  		border-collapse: collapse; 
  		table-layout: fixed; 
  		width: 100%;
  		cellspacing: 5;
  		border: 2px solid #000;
  		cellpadding: 5;
  	}
  	table td {
  		border: solid 1px #fab;
  		width: 9%;
  		word-wrap: break-word;
  		text-align: center;
  	}
  	table thead {
  		border: 2px solid #000;
  		font-style: italic;
  	}
  	
  	table.narrow {
  		width: 30%;
  	}
  	
  	td.thirtyTwo {
  		background-color: #C7F0E5;
  		text-align: center;
  	}
  	td.sixteen {
  		background-color: #FFFF99;
  		text-align: right;
  	}
  	td.eight {
  		background-color: #FCE4EC;
  		text-align: right;
  	}
  	td.quarter {
  		background-color: #CCEAC5;
  		text-align: right;
  	}
  	td.sixtyFour {
  		text-align: left;
  	}
  	
  	td.num {
  		text-align: right;
  	}
  	td.frac {
  		text-align: left;
  	}
  	td.mm {
  		text-align: right;
  		background-color: #EEEEDD;
  	}
  	td.smcps {
  		font-variant: small-caps;
  	}
  	tag.num {
  		font-size: 80%;
  	}
</style>

<script type="text/javascript">
<!--

window.onload = function() {
	let canvas = document.getElementById("drawingCanvas");
	let context = canvas.getContext("2d");
	
	let centerX = 150;
	let centerY = 150;
	let radius = 100;
	let buffer = 10;
	let stockLen = 125;
	let startingAngle = 1.56 * Math.PI;
	let endingAngle = 1.559 * Math.PI;
	let stepX = 20;
	let stepY = 5;
	let vertOffset = Math.cos(Math.PI/6)*radius;
	let horizOffset = Math.sin(Math.PI/6)*radius;
	
	context.lineWidth = 1;
	
	// Circle
	context.arc(centerX, centerY, radius + buffer, startingAngle, endingAngle);
	context.stroke();
	
	// Step measurement line
	context.beginPath();
	context.moveTo(centerX + 2*stepX,260);
	context.lineTo(centerX + 3*stepX,260);
	context.stroke();
	
	context.beginPath();
	context.moveTo(centerX + 2*stepX,270);
	context.lineTo(centerX + 2*stepX,250);
	context.stroke();

	context.beginPath();
	context.moveTo(centerX + 3*stepX,250);
	context.lineTo(centerX + 3*stepX,270);
	context.stroke();
	
	context.beginPath();
	context.font = "bold 12px Arial";
	context.textBaseline = "top";
	context.fillStyle = "black";
	context.fillText("Step size", 175, 275);
	
	context.lineWidth = 2;
	context.strokeStyle = "black";
		
	centerX = centerX + stepX;
	
	// Top side of stock
	context.beginPath();
	context.moveTo(centerX,centerY - radius - stockLen);
	context.lineTo(centerX,centerY - radius);
	context.stroke();
	
	// Bottom side of stock
	context.beginPath();
	context.moveTo(centerX,centerY + radius + stockLen);
	context.lineTo(centerX,centerY + radius);
	context.stroke();
	
	// First step down and right
	context.beginPath();
	context.moveTo(centerX,centerY - radius);
	context.lineTo(centerX,centerY - radius + stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX,centerY - radius + stepY);
	context.lineTo(centerX + stepX,centerY - radius + stepY);
	context.stroke();
	
	// Second step down and right
	context.beginPath();
	context.moveTo(centerX + stepX,centerY - radius + stepY);
	context.lineTo(centerX + stepX,centerY - radius + 3*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX + stepX,centerY - radius + 3*stepY);
	context.lineTo(centerX + 2*stepX,centerY - radius + 3*stepY);
	context.stroke();
	
	// Third step down and right
	context.beginPath();
	context.moveTo(centerX + 2*stepX,centerY - radius + 3*stepY);
	context.lineTo(centerX + 2*stepX,centerY - radius + 6*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX + 2*stepX,centerY - radius + 6*stepY);
	context.lineTo(centerX + 3*stepX,centerY - radius + 6*stepY);
	context.stroke();
	
	// Fourth step down and right
	context.beginPath();
	context.moveTo(centerX + 3*stepX,centerY - radius + 6*stepY);
	context.lineTo(centerX + 3*stepX,centerY - radius + 12*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX + 3*stepX,centerY - radius + 12*stepY);
	context.lineTo(centerX + 4*stepX,centerY - radius + 12*stepY);
	context.stroke();
	
	// Fifth step down
	context.beginPath();
	context.moveTo(centerX + 4*stepX,centerY - radius + 12*stepY);
	context.lineTo(centerX + 4*stepX,centerY - radius + 28*stepY);
	context.stroke();
	
	// Sixth step left and down
	context.beginPath();
	context.moveTo(centerX + 4*stepX,centerY - radius + 28*stepY);
	context.lineTo(centerX + 3*stepX,centerY - radius + 28*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX + 3*stepX,centerY - radius + 28*stepY);
	context.lineTo(centerX + 3*stepX,centerY - radius + 34*stepY);
	context.stroke();
	
	// Seventh step left and down
	context.beginPath();
	context.moveTo(centerX + 3*stepX,centerY - radius + 34*stepY);
	context.lineTo(centerX + 2*stepX,centerY - radius + 34*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX + 2*stepX,centerY - radius + 34*stepY);
	context.lineTo(centerX + 2*stepX,centerY - radius + 37*stepY);
	context.stroke();
	
	// Eighth step left and down
	context.beginPath();
	context.moveTo(centerX + 2*stepX,centerY - radius + 37*stepY);
	context.lineTo(centerX + 1*stepX,centerY - radius + 37*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX + 1*stepX,centerY - radius + 37*stepY);
	context.lineTo(centerX + 1*stepX,centerY - radius + 39*stepY);
	context.stroke();
	
	// Ninth step left and down
	context.beginPath();
	context.moveTo(centerX + 1*stepX,centerY - radius + 39*stepY);
	context.lineTo(centerX,centerY - radius + 39*stepY);
	context.stroke();
	context.beginPath();
	context.moveTo(centerX,centerY - radius + 39*stepY);
	context.lineTo(centerX,centerY - radius + 40*stepY);
	context.stroke();
	
	
	context.beginPath();
	context.font = "bold 12px Arial";
	context.textBaseline = "top";
	context.fillStyle = "black";
	context.fillText("Radius", 130, 155);
	
	// Radius dimension line
	context.beginPath();
	context.moveTo(centerX - stepX,centerY);
	context.lineTo(centerX - stepX + radius,centerY);
	context.stroke();
	
} //end of drawing

// round
// Rounds a number to a specified amount of digits.
// Use Math.round() and template literals to round the number to the specified number 
// of digits. Omit the second argument, decimals to round to an integer.
const round = (n, decimals = 0) => Number(`${Math.round(`${n}e${decimals}`)}e-${decimals}`);

function getDepthOfCut(width,radius,fileBuffer)
{
	// a^2 = r^2 - (w/2)^2, where a = r - x or the depth of cut (sans buffer)
	// x is height of arc when parting tool of width w touches inside of circle
	
	let a = Math.sqrt(radius**2 - (width/2)**2)
	
	return a - fileBuffer;
}

function makeTable() {

	let radius = parseFloat(document.getElementById("radius").value);
	let toolWidth = parseFloat(document.getElementById("toolWidth").value);
	let stepSize = parseFloat(document.getElementById("stepSize").value);
	let wholeRadius = radius * 1000; // use a whole number for convenience
	let numOfSteps = Math.floor((radius - toolWidth/2) / stepSize);
	let precision = document.getElementById("precision").value;
	let fileBuffer = document.getElementById("buffer").value;
	
	if (precision == "")
	{
		precision = 3;
	} // end if
	
	if (fileBuffer == "")
	{
		fileBuffer = "0.003";
	}
	fileBuffer = parseFloat(fileBuffer);
	
	let initialDOC = getDepthOfCut(toolWidth,radius,fileBuffer).toPrecision(precision);
	
	let y = 0.0;
	let carriage = new Number();
	let crossSlide = new Number();
		
	let x;
	let stepNum = 0;
			
	let div = document.getElementsByTagName("div")[0];
	let tablI, rowI;
	
	tablI = document.createElement("table");
	tablI.createTHead();
	rowI = tablI.tHead.insertRow();
	let headCell = rowI.insertCell(0);
	headCell.setAttribute('colSpan', '5');
	headCell.innerHTML = 'Cutting a Groove of Radius ' + radius + " with Step Size " + stepSize;

	tablI.createTHead();
	rowI = tablI.tHead.insertRow();
	let head2Cell = rowI.insertCell(0);
	head2Cell.setAttribute('colSpan', '5');
	head2Cell.innerHTML = 'First cut with ' + toolWidth + " parting tool is to depth " + initialDOC;


	tablI.appendChild(document.createElement('tbody'));
	rowI = tablI.tBodies[0].insertRow();
	let brkCell = rowI.insertCell(0);
	brkCell.setAttribute('colSpan', '3');
	brkCell.innerHTML = ' ';
	
	rowI = tablI.tBodies[0].insertRow();
	let cell0 = rowI.insertCell(0);
	cell0.innerHTML = "Step #";
	let cell1 = rowI.insertCell(1);
	cell1.innerHTML = "x";
	let cell2 = rowI.insertCell(2);
	cell2.innerHTML = "y";
	let cell3 = rowI.insertCell(3);
	cell3.innerHTML = "Carriage travel to right";
	let cell4 = rowI.insertCell(4);
	cell4.innerHTML = "Cross slide cutting travel";
	
	for (let counter = 1; counter <= Math.floor((radius - toolWidth/2)/stepSize); counter++) {
	
		x = counter/1000;
		y = y + stepSize;
		y = round(y, precision);
		//y = y.toPrecision(precision);
		carriage = stepSize;
		carriage = carriage.toPrecision(precision);
		crossSlide = getDepthOfCut(counter * 2 * stepSize + toolWidth, radius, fileBuffer);
		crossSlide = crossSlide.toPrecision(precision);
		
		stepNum += 1;

		rowI = tablI.tBodies[0].insertRow();
		cell0 = rowI.insertCell(0);
		cell0.innerHTML = stepNum;			// put the step number in first cell
		cell1 = rowI.insertCell(1);
		cell1.innerHTML = x;	// put x in second cell
		cell2 = rowI.insertCell(2);
		cell2.innerHTML = y;	// put y in third cell
		cell3 = rowI.insertCell(3);
		cell3.innerHTML = carriage;	// put the carriage travel in third cell
		cell4 = rowI.insertCell(4);
		cell4.innerHTML = crossSlide;	// put the cross slide travel in fourth cell
	}	// end for i
	
	div.appendChild(tablI);

} //end of function

// -->
</script>
</head>

<body>
<h1>Round Groove Cutting Calculator</h1>
<h2>Turning a round groove on the side of your stock</h2><br />

<canvas id="drawingCanvas" width="300" height="300"></canvas>

<p>
	This calculator produces a table of carriage and cross slide movements. With this 
	table an operator can use a lathe  equipped with the parting tool of choice to 
	mimic a radius tool cutting a round groove in the side of a part. The calculator will 
	produce this table using the chosen step size for either roughing out a groove or for 
	producing a groove that requires minimal filing. 
</p>

<p>	
	The program needs three parameters to produce the table of cuts: the radius of the 
	desired groove (e.g., 0.250), the width of the parting tool and the step size (e.g., 
	0.010). Both should be entered in decimal form. (Entering fractions will produce an 
	error of some type, dependent on your browser.) The program assumes that the stock to 
	be cut is more than twice the groove radius in diameter. (Or you will be mimicking a 
	cutoff tool!) The default precision is three decimals, but this can be changed as 
	desired. The final parameter to enter is the filing "buffer". Using the formulas 
	precisely will take the corner of the cutter right up to the circle. Any movement 
	past this point will result in cutting too deep. Since filing is required to remove 
	the shoulders, a little extra can be built in to avoid cutting too deep.
</p>

<p class="note">
	If "Filing Buffer" is left empty, a default of 0.003" will be used. 
	(The picture shows a large and inconsistent buffer.)
</p>

<p>
	To use the chart the following procedure is recommended. A parting tool is centered 
	on the groove width and used to cut a slot to the depth of cut listed in the table. 
	The carriage is then moved one step to the right and the cross slide is advanced 
	according to the value in the table. This is repeated using the same chart, but now 
	the tool starts back in the original cut and advances to the left. File as needed to 
	produce the groove of your dreams!
</p>

<p class="note">
	The x's and y's listed in the table may be of value for a lathe equipped with DROs 
	on both axes.
</p>

<br />

<hr />
<br />

<fieldset>
	<legend>Enter the required data for your planned groove:</legend>
		<label for="radius">Radius of Desired Groove</label>
		<input type="text" id="radius" placeholder="0.250" autofocus><br/>
		<label for="toolWidth">Parting Tool Width</label>
		<input type="text" id="toolWidth" placeholder="0.0625"><br/>
		<label for="stepSize">Planned Step Size</label>
		<input type="text" id="stepSize" placeholder="0.010"><br/>
		<label for="precision">Desired Precision (optional)</label>
		<input tupe="text" id="precision" placeholder="3"><br/>
		<label for="buffer">Filing Buffer (optional)</label>
		<input tupe="text" id="buffer" placeholder="0.003"><br/>
		<br/>
		<input type="button" value="Calculate Cutting Table" onclick="makeTable()"/>
</fieldset>

<p class=note>
	Reload the browser window/tab between calculations if you don't want successive 
	calculations appended.
</p>

<hr />

<div>

</div>

<hr />
</body>
<footer>
<p><a href="Workshop Notebook.html">Table of Contents</a></p>
<p>John H. McDonald, III</p>
	<p>April 11, 2020</p>
</footer>
</html>